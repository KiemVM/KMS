@page "/Role/AddOrUpdate"
@model AddOrUpdateModel
@{
    Layout = null;
    var i = 1;
}
<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered mw-900px">
    <div class="modal-content">
        <div class="modal-header">
            <span class="span-header"><img src="/images/logo-while.png" style="width: 30px" /> @Model.Title</span>
            <button class="btn btn-sm btn-icon" data-bs-dismiss="modal">
                <span class="icon">
                    <i class="las la-times fs-1 text-white"></i>
                </span>
            </button>
        </div>
        <div class="modal-body py-lg-10">
            <div class="w-100">
                <div class="row">
                    <div class="col-lg-4">
                        <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(AppRoleViewModel.Name)))" />
                    </div>
                    <div class="col-lg-4">
                        <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(AppRoleViewModel.DisplayName)))" />
                    </div>
                </div>
                <div class="row">
                    <label class="fs-5 fw-bold ps-4 mt-2">Danh sách phân quyền</label>
                    <div class="col-lg-12 mb-3">
                        <div class="fv-row">
                            <div class="table-responsive">
                                <table class="table align-middle table-row-dashed fs-6 gy-5 border-none">
                                    <tbody class="text-gray-600 fw-semibold">
                                        @foreach (var permissionViewModel in Model.AppRoleViewModel.PermissionViewModels ?? new List<PermissionViewModel>())
                                        {
                                            <tr>
                                                <td class="text-primary ps-1">@i. @permissionViewModel.DisplayName</td>
                                                <td>
                                                    <div class="d-flex">
                                                        @foreach (var item in permissionViewModel.RoleClaimsViewModels ?? new List<RoleClaimsViewModel>())
                                                        {
                                                            <label class="form-check form-check-sm form-check-custom form-check-solid me-12">
                                                                @if (item.Selected)
                                                                {
                                                                    <input class="form-check-input" type="checkbox" name="RoleClaims" value="@item.Value" checked="checked" />
                                                                }
                                                                else
                                                                {
                                                                    <input class="form-check-input" type="checkbox" name="RoleClaims" value="@item.Value" />
                                                                }
                                                                <span class="form-check-label">@item.DisplayName</span>
                                                            </label>
                                                        }
                                                    </div>
                                                </td>
                                            </tr>
                                            i++;
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-right mt-5 me-1">
                <button type="button" class="btn btn-light w-125px" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary w-125px  ms-2" onclick="Save()">Lưu lại</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    function GetRoleClaims() {
        var array = [];
        $("input:checkbox[name=RoleClaims]:checked").each(function () {
            array.push($(this).val());
        });
        return array;
    }
    function Save() {
        objAjax.parameters = {
            Id: "@Model.Id",
            DisplayName: $('#DisplayName').val(),
            Name: $('#Name').val(),
            Permissions: GetRoleClaims(),
        };
        objAjax.divLoading = ".show>>>.modal-body";
        AjaxAsync("@Model.UrlAjax", window.objAjax,
            function (data) {
                window.location.reload();
            });
    }
</script>