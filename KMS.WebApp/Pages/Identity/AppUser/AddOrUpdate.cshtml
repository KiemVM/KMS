@page "/User/AddOrUpdate"
@model AddOrUpdateModel
@{
    Layout = null;
}
<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered mw-800px">
    <div class="modal-content">
        <div class="modal-header">
            <span class="span-header"><img src="/images/logo-while.png" style="width: 30px" /> @Model.Title</span>
            <button class="btn btn-sm btn-icon" data-bs-dismiss="modal">
                <span class="icon">
                    <i class="las la-times fs-1 text-white"></i>
                </span>
            </button>
        </div>
        <div class="modal-body py-lg-10">
            <div class="w-100">
                <div class="row">
                    <div class="col-lg-9">
                        <div class="row">
                            <div class="col-lg-4 mb-3">
                                <div class="form-group row">
                                    <div class="col-lg-12 form-control form-control-floating card">
                                        <select disabled="disabled" id="@nameof(AppUserViewModel.Type)" placeholder="none" class="form-input form-select" data-control="select2" data-placeholder="Chưa chọn" data-minimum-results-for-search="Infinity" data-allow-clear="true" data-dropdown-parent="#FormOpen">
                                            <option value="@Model.Type?.Value()">@Model.Type?.Display()</option>
                                        </select>
                                        <label class="form-label" for="@nameof(AppUserViewModel.Type)">
                                            Loại tài khoản
                                            <span class="text-danger">*</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-8 mb-3">
                                <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(AppUserViewModel.FullName)))"/>
                            </div>
                            <div class="col-lg-4 mb-3">
                                <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(AppUserViewModel.Email)))"/>
                            </div>
                            <div class="col-lg-4 mb-3">
                                <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(AppUserViewModel.Position)))"/>
                            </div>
                            <div class="col-lg-4 mb-3">
                                <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(AppUserViewModel.Dob)))"/>
                            </div>
                            <div class="col-lg-4 mb-3">
                                <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(AppUserViewModel.PhoneNumber)))"/>
                            </div>
                            <div class="col-lg-4 mb-3">
                                <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(AppUserViewModel.BankNumber)))"/>
                            </div>
                            <div class="col-lg-4 mb-3">
                                <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(AppUserViewModel.UserName)))"/>
                            </div>
                            <div class="col-lg-4 mb-3">
                                <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(AppUserViewModel.PasswordSha256)))"/>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="row">
                            <div class="col-lg-12" style="margin: auto; text-align: center;">
                                <div class="symbol symbol-100px symbol-circle mb-7">
                                    <div class="avatar-upload">
                                        <div class="avatar-edit">
                                            <input type='file' id="imageUpload" accept=".png, .jpg, .jpeg" />
                                            <label for="imageUpload">
                                                <i class="las la-edit fs-1" style="margin-left: 7px; margin-top: 4px;"></i>
                                            </label>
                                        </div>
                                        <div class="avatar-preview">
                                            <div id="imagePreview" style="background-image: url('@(Model.UserViewModel?.Avatar)');">
                                            </div>
                                        </div>
                                        <input type="hidden" id="Avatar" value="@(Model.UserViewModel?.Avatar)" />

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-right mt-5 me-1">
                <button type="button" class="btn btn-light w-125px" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary w-125px  ms-2" onclick="Save()">Lưu lại</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $("#imageUpload").change(function () {
        if (this.files && this.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#imagePreview').css('background-image', 'url(' + e.target.result + ')');
                $('#imagePreview').hide();
                $('#imagePreview').fadeIn(650);
            }

            reader.readAsDataURL(this.files[0]);
            var formData = new FormData();
            formData.append("files", this.files[0]);
            window.objAjax.parameters = formData;
            AjaxFile("@(ConstUrl.WebCrm)/api/file/upload-files?path=@(ConstSystem.ProjectName)/Employee/AddOrUpdate&extensions=jpg,jpeg,png,bmp,gif&maxsize=10240", window.objAjax,
                function (response) {
                    debugger
                    $('#imagePreview').css('background-image', 'url(' + response[0].Url + ')');
                    $('#Avatar').val(response[0].Url);
                });
        }
    });
    function Save() {
        objAjax.parameters = {
            Id: "@Model.Id",
            FullName: $('#FullName').val(),
            UserName: $('#UserName').val(),
            PasswordSha256: $('#PasswordSha256').val(),
            Email: $('#Email').val(),
            PhoneNumber: $('#PhoneNumber').val(),
            BankNumber: $('#BankNumber').val(),
            Position: $('#Position').val(),
            Dob: GetDateTime("#Dob"),
            Avatar: $('#Avatar').val(),
            Type: parseInt($('#Type').val())
        };
        objAjax.divLoading = ".show>>>.modal-body";
        AjaxAsync("@Model.UrlAjax", window.objAjax,
            function (data) {
                window.location.reload();
            });
    }
</script>