@page "/Company/AddOrUpdate"
@using KMS.Core.Entities.Content
@using CompanyViewModel = KMS.Core.ViewModels.Content.CompanyViewModel
@model AddOrUpdateModel
@{
    ViewBag.Title = Model.Title;
    ViewBag.ActiveMenu = ConstPathUrl.Company;
}
<div class="toolbar d-flex flex-stack flex-wrap ms-5 mb-5 mb-lg-5" id="kt_toolbar">
    <div class="page-title d-flex flex-column py-1">
        <h1 class="d-flex align-items-center my-1">
            <span class="text-dark fw-bolder fs-1">@ViewBag.Title</span>
        </h1>
    </div>
</div>
<div class="row mb-3">
<div class="col-lg-12 mb-2">
    <div class="row mb-3">
        <div class="col-lg-9">
            <div class="row">
                <div class="col-lg-6 mb-3">
                    <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(CompanyViewModel.Name)))" />
                </div>
                <div class="col-lg-6 mb-3">
                    <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(CompanyViewModel.Address)))" />
                </div>
                <div class="col-lg-6 mb-3">
                    <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(CompanyViewModel.Phone)))" />
                </div>
                <div class="col-lg-6 mb-3">
                    <partial name=@InputForm.TextBox model="@(Model.InputFormViewModels.FirstOrDefault(x => x.Id == nameof(CompanyViewModel.Email)))" />
                </div>
                    <div class="row mb-4 pb-4">
                        <div class="col-lg-12">
                            <div class="form-group summernote">
                                <div class="col-lg-12 form-control" id="Description">@Html.Raw(Model?.CompanyViewModel?.Description)</div>
                            </div>
                        </div>
                    </div>
            </div>
        </div>
        <div class="col-lg-3">
            <div class="row">
                <label>Ảnh</label>
            </div>
            <div class="row">
                <div class="col-lg-12" style="margin: auto; text-align: center;">
                    <div class="symbol symbol-100px symbol-circle mb-7">
                        <div class="avatar-upload">
                            <div class="avatar-edit">
                                <input type='file' id="imageUpload" accept=".png, .jpg, .jpeg" />
                                <label for="imageUpload">
                                    <i class="las la-edit fs-1" style="margin-left: 7px; margin-top: 4px;"></i>
                                </label>
                            </div>
                            <div class="avatar-preview">
                                    <div id="imagePreview" style="background-image: url('@(Model.CompanyViewModel?.Image)');">
                                </div>
                            </div>
                                <input type="hidden" id="Image" value="@(Model.CompanyViewModel?.Image)" />

                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>
    <div style="text-align:right">
        <div>
            <button type="reset" class="btn btn-light me-3 w-120px" data-bs-dismiss="modal" onclick="back()">Quay lại</button>
            <button type="button" class="btn btn-lg btn btn-primary btn-uni w-120px me-3" onclick="Save()">
                Lưu
                <span class="indicator-progress" id="LoadProgress">
                    <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                </span>
            </button>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function() {
        SummernoteCore("#Description", 400);
    });

    $("#imageUpload").change(function () {
        if (this.files && this.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#imagePreview').css('background-image', 'url(' + e.target.result + ')');
                $('#imagePreview').hide();
                $('#imagePreview').fadeIn(650);
            }
            reader.readAsDataURL(this.files[0]);
            var formData = new FormData();
            formData.append("files", this.files[0]);
            window.objAjax.parameters = formData;
            AjaxFile("@(ConstUrl.WebCrm)/api/file/upload-files?path=@(ConstSystem.ProjectName)/Employee/AddOrUpdate&extensions=jpg,jpeg,png,bmp,gif&maxsize=10240", window.objAjax,
                function (response) {
                    debugger
                    $('#imagePreview').css('background-image', 'url(' + response[0].Url + ')');
                    $('#Image').val(response[0].Url);
                });
        }
    });


    function Save() {
        objAjax.parameters = {
            Id: "@Model.Id",
            Name: $('#@nameof(CompanyViewModel.Name)').val(),
            Description: cleanSummernoteData($('#Description').summernote('code')),
            Image: $('#Image').val(),
            Address: $('#@nameof(CompanyViewModel.Address)').val(),
            Phone: $('#@nameof(CompanyViewModel.Phone)').val(),
            Email: $('#@nameof(CompanyViewModel.Email)').val(),
        };
        objAjax.divLoading = ".show>>>.modal-body";
        AjaxAsync("@Model.UrlAjax", window.objAjax,
            function (data) {
                window.location.href="@ConstPathUrl.Company";
            });
    }

    function back() {
        window.location.href="@ConstPathUrl.Company";
    }

</script>